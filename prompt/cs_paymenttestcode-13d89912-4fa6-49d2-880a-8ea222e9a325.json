{
  "id": "13d89912-4fa6-49d2-880a-8ea222e9a325",
  "prefix": "cs_paymenttestcode",
  "description": "Demo Payment test",
  "body": "-- Assemble\nEXEC tsqlt.faketable @TableName = 'Contacts', @SchemaName = 'dbo';\n\nINSERT dbo.Contacts\n(ContactsID, ContactFullName, Address1, Address2,CountryCode, Email)\nVALUES\n(1, N'Louis Davidson', N'17 High Street', N'Darlington', N'USA', N'Louis.Davidson@example.com')\n, (2, N'Adam Machanic', N'37 Green Lane', N'Portsmouth', N'USA', N'Adam.Machanic@example.com')\n, (3, N'Francis Hanlon', N'33 George Street', N'Llandudno', N'USA', N'Francis.Hanlon@example.com')\n;\n\nEXEC tsqlt.FakeTable @TableName = N'ArticlePayment',        -- nvarchar(max)\n                     @SchemaName = N'dbo'\n\nINSERT dbo.ArticlePayment\n(ArticleID, ContactID, PublishDate, PaymentDate, AuthorPaid, ArticlePaymentRate)\nVALUES\n  (1, 1, '2019-01-03', null, 0, 100)\n, (2, 2, '2019-01-04', null, 0, 100)\n, (3, 2, '2019-03-04', null, 0, 100)\n, (4, 2, '2019-04-04', null, 0, 100)\n, (5, 2, '2019-05-04', null, 0, 100)\n, (6, 2, '2019-06-04', null, 0, 100)\n, (7, 3, '2019-01-05', null, 0, 100)\n, (8, 3, '2019-02-05', null, 0, 100)\n, (9, 3, '2019-03-05', null, 0, 100)\n, (10, 3, '2019-04-05', null, 0, 100)\n, (11, 3, '2019-05-05', null, 0, 100)\n, (12, 3, '2019-06-05', null, 0, 100)\n, (13, 3, '2019-07-05', null, 0, 100)\n, (14, 3, '2019-08-05', null, 0, 100)\n, (15, 3, '2019-09-05', null, 0, 100)\n, (16, 3, '2019-10-05', null, 0, 100)\n, (17, 3, '2019-11-05', null, 0, 100)\n\nCREATE TABLE #expected (\nContactID INT\n, NumberOfArticles INT\n, PaymentTotal NUMERIC(6,2)\n)\n\nINSERT #expected\n(ContactID, NumberOfArticles, PaymentTotal)\nVALUES\n  (1, 1, 100.00)\n, (2, 5, 525.00)\n, (3, 11, 1210.00)\n\nSELECT ContactID,\n       NumberOfArticles,\n       PaymentTotal\n INTO #actual\n FROM #expected\n WHERE 1 = 0\n\n-- Act\nINSERT #actual\n  EXEC dbo.PaymentReportForArticles @startdate = '2019-01-01', -- date\n                                  @enddate = '2020-01-01'    -- date\n\n-- Assert\nEXEC tsqlt.AssertEqualsTable @Expected = '#expected',\n                        @Actual = '#actual',   -- sql_variant\n                        @Message = N'Incorrect report calculation'    -- nvarchar(max)\n\n"
}